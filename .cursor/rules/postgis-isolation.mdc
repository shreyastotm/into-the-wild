---
description: "PostGIS and spatial_ref_sys isolation rules"
globs: ["**/*.{sql,ts,tsx}", "supabase/migrations/*"]
alwaysApply: true
---

# üó∫Ô∏è POSTGIS & SPATIAL DATA ISOLATION RULES

## 8.1 PostGIS System Table Isolation
‚úÖ **REQUIRED:** Keep spatial_ref_sys completely isolated from application schema
‚ùå **FORBIDDEN:** Any modifications to spatial_ref_sys table in migrations
‚ùå **FORBIDDEN:** Creating RLS policies on spatial_ref_sys in migrations  
‚ùå **FORBIDDEN:** Granting privileges on spatial_ref_sys to anon/authenticated roles
‚úÖ **REQUIRED:** Use REVOKE ALL ON TABLE public.spatial_ref_sys FROM PUBLIC, anon, authenticated if needed
‚úÖ **REQUIRED:** Never reference spatial_ref_sys in application code

## 8.2 Spatial Data Storage Standards
‚úÖ **REQUIRED:** Use DOUBLE PRECISION for latitude/longitude columns
‚ùå **FORBIDDEN:** Using PostGIS GEOMETRY/GEOGRAPHY types in user tables
‚úÖ **REQUIRED:** Store coordinates as DECIMAL(10,6) or DOUBLE PRECISION
‚úÖ **REQUIRED:** Calculate distances in application layer if needed (not in database)

## 8.3 System Table Protection
‚úÖ **REQUIRED:** Treat spatial_ref_sys as system-only, not application data
‚úÖ **REQUIRED:** Ignore PostGIS system tables in RLS policy creation
‚ùå **FORBIDDEN:** Adding views/functions that expose spatial_ref_sys to REST API
‚ùå **FORBIDDEN:** Creating triggers on PostGIS system tables

## 8.4 Security Linter Handling
‚úÖ **REQUIRED:** Accept security linter warnings about spatial_ref_sys (system table)
‚úÖ **REQUIRED:** If warning appears, use REVOKE statement in Supabase SQL Editor manually
‚ùå **FORBIDDEN:** Attempting to automate RLS enablement on system tables via migrations

## 8.5 PostGIS Extension Policy
‚úÖ **REQUIRED:** PostGIS extension may exist on Supabase but application does NOT use it
‚úÖ **REQUIRED:** All coordinates stored as numeric types, NOT spatial types
‚ùå **FORBIDDEN:** Installing or enabling PostGIS in migrations
‚ùå **FORBIDDEN:** Using ST_MakePoint, ST_Distance, or other PostGIS functions
